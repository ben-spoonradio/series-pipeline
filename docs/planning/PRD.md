# 제품 요구사항 명세 (PRD)

**작성일**: 2026-01-13  
**버전**: 1.0  
**작성자**: (작성자 기입)

---

## 개요

### 목적
- 문서/프로세스 관점에서 `series-pipeline`의 요구사항과 수용 기준을 명확히 합니다.
- LLM/TTS/오디오 처리 파이프라인의 "재현성"과 "운영 가능성"을 우선합니다.

### 배경
- 입력 파일(DOCX/PDF/TXT/HWP 등)을 시리즈 단위로 처리하여 에피소드 분할 → 번역/검수 → TTS 최적화/태깅 → 음성 생성/믹싱까지 자동화합니다.
- `pipeline.py`는 스테이지 실행/스킵/재시도/QA리포트/리뷰 출력까지 오케스트레이션합니다.

---

## 기능 요구사항

### FR-01: 파이프라인 End-to-End 실행

**우선순위**: P0 (필수)

**설명**: 사용자는 단일 소스 파일을 입력하여 0~7(2a/3a/6a 포함) 스테이지를 순차 실행할 수 있다.

**사용자 스토리**:
- 사용자는 `python pipeline.py "<source_file>"`로 파이프라인을 실행할 수 있다.
- 사용자는 스테이지별 산출물을 확인하고 필요한 경우 재실행/스킵할 수 있다.

**수용 기준**:
- [ ] 스테이지 0 실행 후 `series_metadata.json`이 생성된다.
- [ ] 스테이지 2/3/4는 언어별 하위 디렉토리를 가진다.
- [ ] 실패 시 로그 파일(`stage_XX_*.log`)을 통해 원인 파악이 가능하다.

**참고**:
- design: `docs/design/architecture.md`

---

### FR-02: Auto 모드/스테이지 스킵

**우선순위**: P0 (필수)

**설명**: 사용자는 자동 모드로 사람 개입 없이 실행하거나, 스테이지를 선택적으로 스킵할 수 있어야 한다.

**수용 기준**:
- [ ] `--auto` 사용 시 리뷰 프롬프트 없이 다음 스테이지로 진행한다.
- [ ] `--skip-stages 5,6,6a,7` 형태로 스테이지를 스킵할 수 있다.

---

### FR-03: QA 리포트 생성

**우선순위**: P1 (중요)

**설명**: 사용자는 실행 결과 요약(성공/실패/소요시간/산출물)을 Markdown/JSON으로 얻을 수 있어야 한다.

**수용 기준**:
- [ ] `--qa-report` 사용 시 `pipeline_qa_report.md`와 `.json`이 생성된다.

---

### FR-04: 리뷰 출력 및 역동기화(Reverse Sync)

**우선순위**: P1 (중요)

**설명**: 사용자는 사람이 보기 좋은 리뷰 파일을 `_review/`에 생성하고, 편집 내용을 `processed`에 반영할 수 있어야 한다.

**수용 기준**:
- [ ] `--review-output` 사용 시 스테이지 1~5 산출물이 `_review/`에 생성된다.
- [ ] 인터랙티브 모드에서 `s` 선택으로 리뷰 결과를 `processed`에 반영할 수 있다.

---

## 비기능 요구사항

### NFR-01: 재현성/재실행
- 동일 입력에 대해 스테이지별 산출물이 예측 가능해야 한다.
- 이미 산출물이 있을 때의 동작(스킵/재실행/오버라이트)이 일관돼야 한다.

### NFR-02: 비용/레이트리밋
- LLM/TTS API 호출은 `--rate-limit` 기반으로 호출 간격을 유지할 수 있어야 한다.
- 키 누락/레이트리밋/네트워크 오류에 대한 복구 전략이 문서화돼야 한다.

### NFR-03: 보안
- `.env`/API 키는 Git에 커밋하지 않는다.

---

## 우선순위

| 기능 | 우선순위 | 버전 | 상태 |
|------|---------|------|------|
| FR-01 | P0 | v0.1 | ✅ 완료 |
| FR-02 | P0 | v0.1 | ✅ 완료 |
| FR-03 | P1 | v0.1 | ✅ 완료 |
| FR-04 | P1 | v0.1 | ✅ 완료 |
